var c=class{withFields(t){let n=Object.keys(this).map(l=>l in t?t[l]:this[l]);return new this.constructor(...n)}},w=class{static fromArray(t,n){let l=n||new p;return t.reduceRight((a,i)=>new $(i,a),l)}[Symbol.iterator](){return new k(this)}toArray(){return[...this]}atLeastLength(t){for(let n of this){if(t<=0)return!0;t--}return t<=0}hasLength(t){for(let n of this){if(t<=0)return!1;t--}return t===0}countLength(){let t=0;for(let n of this)t++;return t}};var k=class{#e;constructor(t){this.#e=t}next(){if(this.#e instanceof p)return{done:!0};{let{head:t,tail:n}=this.#e;return this.#e=n,{value:t,done:!1}}}},p=class extends w{},$=class extends w{constructor(t,n){super(),this.head=t,this.tail=n}};var g=class e extends c{static isResult(t){return t instanceof e}},f=class extends g{constructor(t){super(),this[0]=t}isOk(){return!0}},o=class extends g{constructor(t){super(),this[0]=t}isOk(){return!1}};function _(e,t,n,l,a,i){let r=new globalThis.Error(a);r.gleam_error=e,r.module=t,r.line=n,r.fn=l;for(let s in i)r[s]=i[s];return r}var It=new DataView(new ArrayBuffer(8));var G=5,A=Math.pow(2,G),jt=A-1,St=A/2,Ct=A/4;function O(e,t){if(e.isOk()){let n=e[0];return new f(t(n))}else{if(e.isOk())throw _("case_no_match","gleam/result",67,"map","No case clause matched",{values:[e]});{let n=e[0];return new o(n)}}}function h(e,t,n,l){if(t?.tag&&e?.nodeType===1){let a=t.tag.toUpperCase(),i=t.namespace||"http://www.w3.org/1999/xhtml";return e.nodeName===a&&e.namespaceURI==i?X(e,t,n,l):q(e,t,n,l)}return t?.tag?q(e,t,n,l):typeof t?.content=="string"?e?.nodeType===3?Q(e,t):Z(e,t):document.createComment(["[internal lustre error] I couldn't work out how to render this element. This","function should only be called internally by lustre's runtime: if you think","this is an error, please open an issue at","https://github.com/hayleigh-dot-dev/gleam-lustre/issues/new"].join(" "))}function q(e,t,n,l=null){let a=t.namespace?document.createElementNS(t.namespace,t.tag):document.createElement(t.tag);a.$lustre={__registered_events:new Set};let i="";for(let r of t.attrs)r[0]==="class"?y(a,r[0],`${a.className} ${r[1]}`):r[0]==="style"?y(a,r[0],`${a.style.cssText} ${r[1]}`):r[0]==="dangerous-unescaped-html"?i+=r[1]:r[0]!==""&&y(a,r[0],r[1],n);if(customElements.get(t.tag))a._slot=t.children;else if(t.tag==="slot"){let r=new p,s=l;for(;s;)if(s._slot){r=s._slot;break}else s=s.parentNode;for(let u of r)a.appendChild(h(null,u,n,a))}else if(i)a.innerHTML=i;else for(let r of t.children)a.appendChild(h(null,r,n,a));return e&&e.replaceWith(a),a}function X(e,t,n,l){let a=e.attributes,i=new Map;e.$lustre??={__registered_events:new Set};for(let r of t.attrs)r[0]==="class"&&i.has("class")?i.set(r[0],`${i.get("class")} ${r[1]}`):r[0]==="style"&&i.has("style")?i.set(r[0],`${i.get("style")} ${r[1]}`):r[0]==="dangerous-unescaped-html"&&i.has("dangerous-unescaped-html")?i.set(r[0],`${i.get("dangerous-unescaped-html")} ${r[1]}`):r[0]!==""&&i.set(r[0],r[1]);for(let{name:r,value:s}of a)if(!i.has(r))e.removeAttribute(r);else{let u=i.get(r);u!==s&&(y(e,r,u,n),i.delete(r))}for(let r of e.$lustre.__registered_events)if(!i.has(r)){let s=r.slice(2).toLowerCase();e.removeEventListener(s,e.$lustre[`${r}Handler`]),e.$lustre.__registered_events.delete(r),delete e.$lustre[r],delete e.$lustre[`${r}Handler`]}for(let[r,s]of i)y(e,r,s,n);if(customElements.get(t.tag))e._slot=t.children;else if(t.tag==="slot"){let r=e.firstChild,s=new p,u=l;for(;u;)if(u._slot){s=u._slot;break}else u=u.parentNode;for(;r;)Array.isArray(s)&&s.length?h(r,s.shift(),n,e):s.head&&(h(r,s.head,n,e),s=s.tail),r=r.nextSibling;for(let d of s)e.appendChild(h(null,d,n,e))}else if(i.has("dangerous-unescaped-html"))e.innerHTML=i.get("dangerous-unescaped-html");else{let r=e.firstChild,s=t.children;for(;r;)if(Array.isArray(s)&&s.length){let u=r.nextSibling;h(r,s.shift(),n,e),r=u}else if(s.head){let u=r.nextSibling;h(r,s.head,n,e),s=s.tail,r=u}else{let u=r.nextSibling;r.remove(),r=u}for(let u of s)e.appendChild(h(null,u,n,e))}return e}function y(e,t,n,l){switch(typeof n){case(t.startsWith("data-lustre-on-")&&"string"):{if(!n){e.removeAttribute(t),e.removeEventListener(a,e.$lustre[`${t}Handler`]);break}if(e.hasAttribute(t))break;let a=t.slice(15).toLowerCase(),i=r=>l(ee(r));e.$lustre[`${t}Handler`]&&e.removeEventListener(a,e.$lustre[`${t}Handler`]),e.addEventListener(a,i),e.$lustre[t]=n,e.$lustre[`${t}Handler`]=i,e.$lustre.__registered_events.add(t),e.setAttribute(t,n);break}case"string":e.getAttribute(t)!==n&&e.setAttribute(t,n),n===""&&e.removeAttribute(t),t==="value"&&e.value!==n&&(e.value=n);break;case(t.startsWith("on")&&"function"):{if(e.$lustre[t]===n)break;let a=t.slice(2).toLowerCase(),i=r=>O(n(r),l);e.$lustre[`${t}Handler`]&&e.removeEventListener(a,e.$lustre[`${t}Handler`]),e.addEventListener(a,i),e.$lustre[t]=n,e.$lustre[`${t}Handler`]=i,e.$lustre.__registered_events.add(t);break}default:e[t]=n}}function Z(e,t){let n=document.createTextNode(t.content);return e&&e.replaceWith(n),n}function Q(e,t){let n=e.nodeValue,l=t.content;return l?(n!==l&&(e.nodeValue=l),e):(e?.remove(),null)}function ee(e){let t=e.target,n=t.getAttribute(`data-lustre-on-${e.type}`),l=JSON.parse(t.getAttribute("data-lustre-data")||"{}"),a=JSON.parse(t.getAttribute("data-lustre-include")||"[]");switch(e.type){case"input":case"change":a.push("target.value");break}return{tag:n,data:a.reduce((i,r)=>{let s=r.split(".");for(let u=0,d=i,b=e;u<s.length;u++)u===s.length-1?d[s[u]]=b[s[u]]:(d[s[u]]??={},b=b[s[u]],d=d[s[u]]);return i},l)}}var E=class extends HTMLElement{static get observedAttributes(){return["route"]}#e=null;#t=null;constructor(){super()}connectedCallback(){this.#e=document.createElement("div"),this.appendChild(this.#e)}attributeChangedCallback(t,n,l){switch(t){case"route":if(!l)this.#t?.close(),this.#t=null;else if(n!==l){let a=this.getAttribute("id"),i=l+(a?`?id=${a}`:"");this.#t?.close(),this.#t=new WebSocket(`ws://${window.location.host}${i}`),this.#t.addEventListener("message",({data:r})=>{let s=JSON.parse(r);switch(s.$){case"Patch":{this.patch(s.vdom);break}}})}}}patch(t){let n=({tag:l,data:a})=>this.#t?.send(JSON.stringify({$:"Event",tag:l,event:a}));this.#e=h(this.#e,t,n)}disconnectedCallback(){this.#t?.close()}};customElements.define("lustre-server-component",E);export{E as LustreServerComponent};
