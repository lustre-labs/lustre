function ct(n){return n.replaceAll(/[><&"']/g,e=>{switch(e){case">":return"&gt;";case"<":return"&lt;";case"'":return"&#39;";case"&":return"&amp;";case'"':return"&quot;";default:return e}})}function ut(n){return ct(n)}function we(n){return ut(n)}var m=class{withFields(e){let t=Object.keys(this).map(r=>r in e?e[r]:this[r]);return new this.constructor(...t)}},Q=class{static fromArray(e,t){let r=t||new p;for(let i=e.length-1;i>=0;--i)r=new K(e[i],r);return r}[Symbol.iterator](){return new Ue(this)}toArray(){return[...this]}atLeastLength(e){let t=this;for(;e-- >0&&t;)t=t.tail;return t!==void 0}hasLength(e){let t=this;for(;e-- >0&&t;)t=t.tail;return e===-1&&t instanceof p}countLength(){let e=this,t=0;for(;e;)e=e.tail,t++;return t-1}};function a(n,e){return new K(n,e)}function x(n,e){return Q.fromArray(n,e)}var Ue=class{#r;constructor(e){this.#r=e}next(){if(this.#r instanceof p)return{done:!0};{let{head:e,tail:t}=this.#r;return this.#r=t,{value:e,done:!1}}}},p=class extends Q{};var K=class extends Q{constructor(e,t){super(),this.head=e,this.tail=t}},qe=(n,e)=>new K(n,e);var De=n=>n.head,ye=n=>n.tail;var oe=class n extends m{static isResult(e){return e instanceof n}},b=class extends oe{constructor(e){super(),this[0]=e}isOk(){return!0}},X=n=>new b(n),le=n=>n instanceof b,ce=n=>n[0],S=class extends oe{constructor(e){super(),this[0]=e}isOk(){return!1}},Y=n=>new S(n);var w=class extends m{},ft=()=>new w;var y=class extends m{},pt=()=>new y;var H=class extends m{},dt=()=>new H;var Qn=5,yi=(1<<Qn)-1,ki=Symbol(),vi=Symbol();var g=class extends m{},V=class extends m{};function fe(n,e){for(;;){let t=n,r=e;if(t instanceof p)return r;{let i=t.head;n=t.tail,e=a(i,r)}}}function E(n){return fe(n,x([]))}function tr(n,e,t,r,i,o){for(;;){let l=n,s=e,c=t,u=r,h=i,d=o,f=a(h,c);if(l instanceof p)return u instanceof g?a(E(f),d):a(f,d);{let _=l.head,$=l.tail,j=s(h,_);if(u instanceof g)if(j instanceof w)n=$,e=s,t=f,r=u,i=_,o=d;else if(j instanceof y)n=$,e=s,t=f,r=u,i=_,o=d;else{let v;u instanceof g?v=a(E(f),d):v=a(f,d);let M=v;if($ instanceof p)return a(x([_]),M);{let A=$.head,F=$.tail,C,P=s(_,A);P instanceof w?C=new g:P instanceof y?C=new g:C=new V;let se=C;n=F,e=s,t=x([_]),r=se,i=A,o=M}}else if(j instanceof w){let v;u instanceof g?v=a(E(f),d):v=a(f,d);let M=v;if($ instanceof p)return a(x([_]),M);{let A=$.head,F=$.tail,C,P=s(_,A);P instanceof w?C=new g:P instanceof y?C=new g:C=new V;let se=C;n=F,e=s,t=x([_]),r=se,i=A,o=M}}else if(j instanceof y){let v;u instanceof g?v=a(E(f),d):v=a(f,d);let M=v;if($ instanceof p)return a(x([_]),M);{let A=$.head,F=$.tail,C,P=s(_,A);P instanceof w?C=new g:P instanceof y?C=new g:C=new V;let se=C;n=F,e=s,t=x([_]),r=se,i=A,o=M}}else n=$,e=s,t=f,r=u,i=_,o=d}}}function nr(n,e,t,r){for(;;){let i=n,o=e,l=t,s=r;if(i instanceof p)return fe(o,s);if(o instanceof p)return fe(i,s);{let c=i.head,u=i.tail,h=o.head,d=o.tail,f=l(c,h);f instanceof w?(n=u,e=o,t=l,r=a(c,s)):f instanceof y?(n=i,e=d,t=l,r=a(h,s)):(n=i,e=d,t=l,r=a(h,s))}}}function rr(n,e,t){for(;;){let r=n,i=e,o=t;if(r instanceof p)return E(o);{let l=r.tail;if(l instanceof p){let s=r.head;return E(a(E(s),o))}else{let s=r.head,c=l.head,u=l.tail,h=nr(s,c,i,x([]));n=u,e=i,t=a(h,o)}}}}function ir(n,e,t,r){for(;;){let i=n,o=e,l=t,s=r;if(i instanceof p)return fe(o,s);if(o instanceof p)return fe(i,s);{let c=i.head,u=i.tail,h=o.head,d=o.tail,f=l(c,h);f instanceof w?(n=i,e=d,t=l,r=a(h,s)):f instanceof y?(n=u,e=o,t=l,r=a(c,s)):(n=u,e=o,t=l,r=a(c,s))}}}function sr(n,e,t){for(;;){let r=n,i=e,o=t;if(r instanceof p)return E(o);{let l=r.tail;if(l instanceof p){let s=r.head;return E(a(E(s),o))}else{let s=r.head,c=l.head,u=l.tail,h=ir(s,c,i,x([]));n=u,e=i,t=a(h,o)}}}}function or(n,e,t){for(;;){let r=n,i=e,o=t;if(r instanceof p)return r;if(i instanceof g){if(r.tail instanceof p)return r.head;n=rr(r,o,x([])),e=new V,t=o}else if(r.tail instanceof p){let s=r.head;return E(s)}else n=sr(r,o,x([])),e=new g,t=o}}function $t(n,e){if(n instanceof p)return n;{let t=n.tail;if(t instanceof p)return n;{let r=n.head,i=t.head,o=t.tail,l,s=e(r,i);s instanceof w?l=new g:s instanceof y?l=new g:l=new V;let c=l,u=tr(o,e,x([r]),c,i,x([]));return or(u,new g,e)}}}var kt=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),xs=new RegExp(`^[${kt}]*`),$s=new RegExp(`[${kt}]*$`);var B=x([]);function ee(){return null}function he(n,e,t){return n??=new Map,n.set(e,t),n}var Tr=dt(),Or=ft(),zr=pt();function Ve(n,e){return n.name===e.name?zr:n.name<e.name?Or:Tr}var I=class extends m{constructor(e,t,r){super(),this.kind=e,this.name=t,this.value=r}};var Ge=0,qt=1,Dt=2,Pt=0;var We=2;function qr(n,e){for(;;){let t=n,r=e;if(t instanceof p)return r;{let i=t.head;if(i instanceof I){let o=i.name;if(o==="")n=t.tail,e=r;else if(o==="class"){let l=i.value;if(l==="")n=t.tail,e=r;else{let s=t.tail;if(s instanceof p){let c=i;n=s,e=a(c,r)}else{let c=s.head;if(c instanceof I)if(c.name==="class"){let h=i.kind,d=l,f=s.tail,_=c.value,$=d+" "+_,j=new I(h,"class",$);n=a(j,f),e=r}else{let h=i;n=s,e=a(h,r)}else{let u=i;n=s,e=a(u,r)}}}}else if(o==="style"){let l=i.value;if(l==="")n=t.tail,e=r;else{let s=t.tail;if(s instanceof p){let c=i;n=s,e=a(c,r)}else{let c=s.head;if(c instanceof I)if(c.name==="style"){let h=i.kind,d=l,f=s.tail,_=c.value,$=d+";"+_,j=new I(h,"style",$);n=a(j,f),e=r}else{let h=i;n=s,e=a(h,r)}else{let u=i;n=s,e=a(u,r)}}}}else{let l=i;n=t.tail,e=a(l,r)}}else{let o=i;n=t.tail,e=a(o,r)}}}}function Lt(n){if(n instanceof p)return n;if(n.tail instanceof p)return n;{let r=$t(n,(i,o)=>Ve(o,i));return qr(r,B)}}function Rt(n,e){return new I(Ge,n,e)}var G=class extends m{constructor(e,t,r,i){super(),this.kind=e,this.key=t,this.children=r,this.keyed_children=i}};var L=class extends m{constructor(e,t,r,i,o,l,s,c,u){super(),this.kind=e,this.key=t,this.namespace=r,this.tag=i,this.attributes=o,this.children=l,this.keyed_children=s,this.self_closing=c,this.void=u}};var W=class extends m{constructor(e,t,r){super(),this.kind=e,this.key=t,this.content=r}};var te=class extends m{constructor(e,t,r,i,o,l){super(),this.kind=e,this.key=t,this.namespace=r,this.tag=i,this.attributes=o,this.inner_html=l}};var U=class extends m{constructor(e,t,r,i){super(),this.kind=e,this.key=t,this.mapper=r,this.child=i}};var xe=class extends m{constructor(e,t,r,i){super(),this.kind=e,this.key=t,this.dependencies=r,this.view=i}};var ne=0,J=1,re=2,Ft=3,R=4,Je=5;function Ae(n,e){return e===""?n==="area"||n==="base"||n==="br"||n==="col"||n==="embed"||n==="hr"||n==="img"||n==="input"||n==="link"||n==="meta"||n==="param"||n==="source"||n==="track"?!0:n==="wbr":!1}function Me(n,e){if(e instanceof G)return new G(e.kind,n,e.children,e.keyed_children);if(e instanceof L)return new L(e.kind,n,e.namespace,e.tag,e.attributes,e.children,e.keyed_children,e.self_closing,e.void);if(e instanceof W)return new W(e.kind,n,e.content);if(e instanceof te)return new te(e.kind,n,e.namespace,e.tag,e.attributes,e.inner_html);if(e instanceof U){let t=e.child;return new U(e.kind,n,e.mapper,Me(n,t))}else{let t=e.view;return new xe(e.kind,n,e.dependencies,()=>Me(n,t()))}}function Qe(n,e,t){return new G(ne,n,e,t)}function Be(n,e,t,r,i,o,l,s){return new L(J,n,e,t,Lt(r),i,o,l,s)}function Ke(n,e){return new W(re,n,e)}function Ht(n,e){if(n instanceof U){let t=n.mapper;return new U(R,n.key,r=>e(t(r)),n.child)}else return new U(R,n.key,e,n)}function Vt(n,e,t){return new xe(Je,n,e,t)}var Gt=0,Wt=1,Jt=2,Qt=3,Kt=4,Xt=5,Yt=6;var en="	",tn="\r";var q=(n,e)=>{if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else if(n)for(n;ye(n);n=ye(n))e(De(n))};var O=()=>globalThis?.document,ie="http://www.w3.org/1999/xhtml";var rn=!!globalThis.HTMLElement?.prototype?.moveBefore;var Rr=globalThis.setTimeout,Xe=globalThis.clearTimeout,D=n=>n!=null?X(n):Y(void 0),T=Symbol("lustre"),Ze=class{constructor(e,t,r,i){this.kind=e,this.key=i,this.parent=t,this.children=[],this.node=r,this.endNode=null,this.handlers=new Map,this.throttles=new Map,this.debouncers=new Map}get isVirtual(){return this.kind===ne||this.kind===R}get parentNode(){return this.isVirtual?this.node.parentNode:this.node}};var z=(n,e,t,r,i)=>{let o=new Ze(n,e,t,i);return t[T]=o,e?.children.splice(r,0,o),o},Fr=n=>{let e="";for(let t=n[T];t.parent;t=t.parent){let r=t.parent&&t.parent.kind===R?tn:en;if(t.key)e=`${r}${t.key}${e}`;else{let i=t.parent.children.indexOf(t);e=`${r}${i}${e}`}}return e.slice(1)},$e=class{#r=null;#t;#n;#e;#i=!1;constructor(e,t,r,i,{debug:o=!1}={}){this.#r=e,this.#t=t,this.#n=r,this.#e=i,this.#i=o}mount(e){z(J,null,this.#r,0,null),this.#p(this.#r,null,this.#r[T],0,e)}push(e,t=null){this.#s=t,this.#o.push({node:this.#r[T],patch:e}),this.#l()}#s;#o=[];#l(){let e=this.#o;for(;e.length;){let{node:t,patch:r}=e.pop(),{children:i}=t,{changes:o,removed:l,children:s}=r;q(o,c=>this.#c(t,c)),l&&this.#$(t,i.length-l,l),q(s,c=>{let u=i[c.index|0];this.#o.push({node:u,patch:c})})}}#c(e,t){switch(t.kind){case Gt:this.#j(e,t);break;case Wt:this.#w(e,t);break;case Jt:this.#E(e,t);break;case Qt:this.#m(e,t);break;case Kt:this.#x(e,t);break;case Xt:this.#a(e,t);break;case Yt:this.#u(e,t);break}}#u(e,{children:t,before:r}){let i=this.#e.create_fragment(),o=this.#f(e,r);this.#g(i,null,e,r|0,t),this.#e.insert_before(e.parentNode,i,D(o))}#a(e,{index:t,with:r}){this.#$(e,t|0,1);let i=this.#f(e,t);this.#p(e.parentNode,i,e,t|0,r)}#f(e,t){t=t|0;let{children:r}=e,i=r.length;if(t<i)return r[t].node;if(e.endNode)return e.endNode;if(!e.isVirtual)return null;for(;e.isVirtual&&e.children.length;){if(e.endNode)return e.endNode.nextSibling;e=e.children[e.children.length-1]}return e.node.nextSibling}#m(e,{key:t,before:r}){r=r|0;let{children:i,parentNode:o}=e,l=i[r].node,s=i[r];for(let c=r+1;c<i.length;++c){let u=i[c];if(i[c]=s,s=u,u.key===t){i[r]=u;break}}this.#h(o,s,l)}#d(e,t,r){for(let i=0;i<t.length;++i)this.#h(e,t[i],r)}#h(e,t,r){this.#e.move_before(e,t.node,D(r)),t.isVirtual&&this.#d(e,t.children,r),t.endNode&&this.#e.move_before(e,t.endNode,D(r))}#x(e,{index:t}){this.#$(e,t,1)}#$(e,t,r){let{children:i,parentNode:o}=e,l=i.splice(t,r);for(let s=0;s<l.length;++s){let c=l[s],{node:u,endNode:h,isVirtual:d,children:f}=c;this.#e.remove_child(o,u),h&&this.#e.remove_child(o,h),this.#b(c),d&&l.push(...f)}}#b(e){let{debouncers:t,children:r}=e;for(let{timeout:i}of t.values())i&&Xe(i);t.clear(),q(r,i=>this.#b(i))}#E({node:e,handlers:t,throttles:r,debouncers:i},{added:o,removed:l}){q(l,({name:s})=>{t.delete(s)?(this.#e.remove_event_listener(e,s,Ye),this.#_(r,s,0),this.#_(i,s,0)):(this.#e.remove_attribute(e,s),on[s]?.removed?.(e,s))}),q(o,s=>this.#v(e,s))}#j({node:e},{content:t}){this.#e.set_text(e,t??"")}#w({node:e},{inner_html:t}){this.#e.set_inner_html(e,t??"")}#g(e,t,r,i,o){q(o,l=>this.#p(e,t,r,i++,l))}#p(e,t,r,i,o){switch(o.kind){case J:{let l=this.#y(r,i,o);this.#g(l,null,l[T],0,o.children),this.#e.insert_before(e,l,D(t));break}case re:{let l=this.#C(r,i,o);this.#e.insert_before(e,l,D(t));break}case ne:{let l="lustre:fragment",s=this.#k(l,r,i,o);this.#e.insert_before(e,s,D(t)),this.#g(e,t,s[T],0,o.children),this.#i&&(s[T].endNode=this.#e.create_comment(` /${l} `),this.#e.insert_before(e,s[T].endNode,D(t)));break}case Ft:{let l=this.#y(r,i,o);this.#w({node:l},o),this.#e.insert_before(e,l,D(t));break}case R:{let l=this.#k("lustre:map",r,i,o);this.#e.insert_before(e,l,D(t)),this.#p(e,t,l[T],0,o.child);break}case Je:{let l=this.#s?.get(o.view)??o.view();this.#p(e,t,r,i,l);break}}}#y(e,t,{kind:r,key:i,tag:o,namespace:l,attributes:s}){let c=this.#e.create_element(l||ie,o);return z(r,e,c,t,i),this.#i&&i&&this.#e.set_attribute(c,"data-lustre-key",i),q(s,u=>this.#v(c,u)),c}#C(e,t,{kind:r,key:i,content:o}){let l=this.#e.create_text_node(o??"");return z(r,e,l,t,i),l}#k(e,t,r,{kind:i,key:o}){let l=this.#i?this.#e.create_comment(Hr(e,o)):this.#e.create_text_node("");return z(i,t,l,r,o),l}#v(e,t){let{debouncers:r,handlers:i,throttles:o}=e[T],{kind:l,name:s,value:c,prevent_default:u,debounce:h,throttle:d}=t;switch(l){case Ge:{let f=c??"";if(s==="virtual:defaultValue"){this.#e.set_property(e,"defaultValue",f);return}else if(s==="virtual:defaultChecked"){this.#e.set_property(e,"defaultChecked",!0);return}else if(s==="virtual:defaultSelected"){this.#e.set_property(e,"defaultSelected",!0);return}let _=this.#e.get_attribute(e,s),$=le(_)?ce(_):null;f!==$&&this.#e.set_attribute(e,s,f),on[s]?.added?.(e,f);break}case qt:this.#e.set_property(e,s,c);break;case Dt:{i.has(s)&&this.#e.remove_event_listener(e,s,Ye);let f=u.kind===Pt;this.#e.add_event_listener(e,s,Ye,f),this.#_(o,s,d),this.#_(r,s,h),i.set(s,_=>this.#S(t,_));break}}}#_(e,t,r){let i=e.get(t);if(r>0)i?i.delay=r:e.set(t,{delay:r});else if(i){let{timeout:o}=i;o&&Xe(o),e.delete(t)}}#S(e,t){let{currentTarget:r,type:i}=t,{debouncers:o,throttles:l}=r[T],s=Fr(r),{prevent_default:c,stop_propagation:u,include:h}=e;c.kind===We&&t.preventDefault(),u.kind===We&&t.stopPropagation(),i==="submit"&&(t.detail??={},t.detail.formData=[...new FormData(t.target,t.submitter).entries()]);let d=this.#t(t,s,i,h),f=l.get(i);if(f){let $=Date.now(),j=f.last||0;$>j+f.delay&&(f.last=$,f.lastEvent=t,this.#n(t,d))}let _=o.get(i);_&&(Xe(_.timeout),_.timeout=Rr(()=>{t!==l.get(i)?.lastEvent&&this.#n(t,d)},_.delay)),!f&&!_&&this.#n(t,d)}},Hr=(n,e)=>e?` ${n} key="${we(e)}" `:` ${n} `,Ye=n=>{let{currentTarget:e,type:t}=n;e[T].handlers.get(t)(n)},sn=n=>({added(e){e[n]=!0},removed(e){e[n]=!1}}),Vr=n=>({added(e,t){e[n]=t}}),on={checked:sn("checked"),selected:sn("selected"),value:Vr("value"),autofocus:{added(n){queueMicrotask(()=>{n.focus?.()})}},autoplay:{added(n){try{n.play?.()}catch(e){console.error(e)}}}};var cn=new WeakMap;async function un(n){let e=[];for(let r of O().querySelectorAll("link[rel=stylesheet], style"))r.sheet||e.push(new Promise((i,o)=>{r.addEventListener("load",i),r.addEventListener("error",o)}));if(await Promise.allSettled(e),!n.host.isConnected)return[];n.adoptedStyleSheets=n.host.getRootNode().adoptedStyleSheets;let t=[];for(let r of O().styleSheets)try{n.adoptedStyleSheets.push(r)}catch{try{let i=cn.get(r);if(!i){i=new CSSStyleSheet;for(let o of r.cssRules)i.insertRule(o.cssText,i.cssRules.length);cn.set(r,i)}n.adoptedStyleSheets.push(i)}catch{let i=r.ownerNode.cloneNode();n.prepend(i),t.push(i)}}return t}var Oe=class extends Event{constructor(e,t,r){super("context-request",{bubbles:!0,composed:!0}),this.context=e,this.callback=t,this.subscribe=r}};function an(n,e){return Rt(n,e)}function fn(n){return Ke("",n)}function pn(){return Ke("","")}function dn(n,e){return Vt("",n,e)}function hn(n){return n}function _n(n,e){return Ht(n,e)}function ei(n,e,t){for(;;){let r=n,i=e,o=t;if(r instanceof p)return[i,E(o)];{let l=r.tail,s=r.head[0],c=r.head[1],u=Me(s,c),h;s===""?h=i:h=he(i,s,u);let d=h,f=a(u,o);n=l,e=d,t=f}}}function et(n){return ei(n,ee(),B)}function mn(n,e,t){let r=et(t),i,o;return i=r[0],o=r[1],Be("","",n,e,o,i,!1,Ae(n,""))}function xn(n,e,t,r){let i=et(r),o,l;return o=i[0],l=i[1],Be("",n,e,t,l,o,!1,Ae(e,n))}function $n(n){let e=et(n),t,r;return t=e[0],r=e[1],Qe("",r,t)}var bn=n=>{let e=z(J,null,n,0,null);for(let r=n.firstChild;r;r=r.nextSibling){let i=ze(e,n,r,0);if(i)return i.vnode}let t=O().createTextNode("");return z(re,e,t,0,null),n.insertBefore(t,n.firstChild),pn()},ze=(n,e,t,r)=>{if(t.nodeType===8){let i=t.data.trim();return i.startsWith("lustre:fragment")?si(n,e,t,r):i.startsWith("lustre:map")?oi(n,e,t,r):i.startsWith("lustre:memo")?li(n,e,t,r):null}return t.nodeType===1?ri(n,t,r):t.nodeType===3?ii(n,t,r):null},ri=(n,e,t)=>{let r=e.getAttribute("data-lustre-key")??"";r&&e.removeAttribute("data-lustre-key");let i=z(J,n,e,t,r),o=e.localName,l=e.namespaceURI,s=!l||l===ie;s&&ui.includes(o)&&ai(o,e);let c=ci(e),u=[];for(let d=e.firstChild;d;){let f=ze(i,e,d,u.length);f?(u.push([f.key,f.vnode]),d=f.next):d=d.nextSibling}let h=s?mn(o,c,ge(u)):xn(l,o,c,ge(u));return be(r,h,e.nextSibling)},ii=(n,e,t)=>(z(re,n,e,t,null),be("",fn(e.data),e.nextSibling)),si=(n,e,t,r)=>{let i=tt(t.data),o=z(ne,n,t,r,i),l=[];for(t=t.nextSibling;t&&(t.nodeType!==8||t.data.trim()!=="/lustre:fragment");){let c=ze(o,e,t,l.length);c?(l.push([c.key,c.vnode]),t=c.next):t=t.nextSibling}o.endNode=t;let s=$n(ge(l));return be(i,s,t?.nextSibling)},oi=(n,e,t,r)=>{let i=tt(t.data),o=z(R,n,t,r,i),l=wn(o,e,t,0);if(!l)return null;let s=_n(l.vnode,c=>c);return be(i,s,l.next)},li=(n,e,t,r)=>{let i=tt(t.data),o=wn(n,e,t,r);if(!o)return null;e.removeChild(t);let l=dn(ge([hn({})]),()=>o.vnode);return be(i,l,o.next)},wn=(n,e,t,r)=>{for(;;){if(t=t.nextSibling,!t)return null;let i=ze(n,e,t,r);if(i)return i}},be=(n,e,t)=>({key:n,vnode:e,next:t}),ci=n=>{let e=[];for(let t=0;t<n.attributes.length;t++){let r=n.attributes[t];r.name!=="xmlns"&&e.push(an(r.localName,r.value))}return ge(e)},ui=["input","select","textarea"],ai=(n,e)=>{let t=e.value,r=e.checked;n==="input"&&e.type==="checkbox"&&!r||n==="input"&&e.type==="radio"&&!r||e.type!=="checkbox"&&e.type!=="radio"&&!t||queueMicrotask(()=>{e.value=t,e.checked=r,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),O().activeElement!==e&&e.dispatchEvent(new Event("blur",{bubbles:!0}))})},tt=n=>{let e=n.match(/key="([^"]*)"/);return e?fi(e[1]):""},fi=n=>n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&#39;/g,"'"),ge=n=>n.reduceRight((e,t)=>qe(t,e),B);var nt=n=>le(n)?ce(n):null,pi=n=>n!=null?X(n):Y(void 0);var yn=n=>{let e=bn(n);return[n,e]};var kn=(n,e)=>O().createElementNS(n||ie,e),vn=n=>O().createTextNode(n??""),En=()=>O().createDocumentFragment(),jn=n=>O().createComment(n),Cn=(n,e,t)=>n.insertBefore(e,nt(t)),Sn=rn?(n,e,t)=>n.moveBefore(e,nt(t)):(n,e,t)=>n.insertBefore(e,nt(t)),Mn=(n,e)=>n.removeChild(e),An=(n,e)=>pi(n.getAttribute(e)),Bn=(n,e,t)=>n.setAttribute(e,t??""),Tn=(n,e)=>n.removeAttribute(e),On=(n,e,t)=>{n[e]=t},zn=(n,e)=>{n.data=e??""},Nn=(n,e)=>{n.innerHTML=e??""},In=(n,e,t,r)=>n.addEventListener(e,t,{passive:r}),Un=(n,e,t)=>n.removeEventListener(e,t),qn=n=>{let e=window.requestAnimationFrame(n);return()=>window.cancelAnimationFrame(e)},Dn=()=>{};var rt=class extends m{constructor(e,t,r,i,o,l,s,c,u,h,d,f,_,$,j,v,M,A,F){super(),this.target=e,this.mount=t,this.create_element=r,this.create_text_node=i,this.create_fragment=o,this.create_comment=l,this.insert_before=s,this.move_before=c,this.remove_child=u,this.get_attribute=h,this.set_attribute=d,this.remove_attribute=f,this.set_property=_,this.set_text=$,this.set_inner_html=j,this.add_event_listener=v,this.remove_event_listener=M,this.schedule_render=A,this.after_render=F}};function di(n,e,t,r,i,o,l,s,c,u,h,d,f,_,$,j,v,M,A){return new rt(n,e,t,r,i,o,l,s,c,u,h,d,f,_,$,j,v,M,A)}function Pn(n){return di(n,yn,kn,vn,En,jn,Cn,Sn,Mn,An,Bn,Tn,On,zn,Nn,In,Un,qn,Dn)}var Ln=0,Rn=1,Fn=2,Hn=3,Ne=0,Vn=1,Gn=2,Ie=3,Wn=4;var it=class extends HTMLElement{static get observedAttributes(){return["route","method"]}#r;#t="ws";#n=null;#e=null;#i=[];#s;#o=new Set;#l=new Set;#c=!1;#u=[];#a=new Map;#f=new Set;#m=new MutationObserver(e=>{let t=[];for(let r of e){if(r.type!=="attributes")continue;let i=r.attributeName;(!this.#c||this.#o.has(i))&&t.push([i,this.getAttribute(i)])}if(t.length===1){let[r,i]=t[0];this.#e?.send({kind:Ne,name:r,value:i})}else t.length?this.#e?.send({kind:Ie,messages:t.map(([r,i])=>({kind:Ne,name:r,value:i}))}):this.#u.push(...t)});constructor(){super(),this.internals=this.attachInternals(),this.#m.observe(this,{attributes:!0})}connectedCallback(){for(let e of this.attributes)this.#u.push([e.name,e.value])}attributeChangedCallback(e,t,r){switch(e){case(t!==r&&"route"):{this.#n=new URL(r,location.href),this.#d();return}case"method":{let i=r.toLowerCase();if(i==this.#t)return;["ws","sse","polling"].includes(i)&&(this.#t=i,this.#t=="ws"&&(this.#n.protocol=="https:"&&(this.#n.protocol="wss:"),this.#n.protocol=="http:"&&(this.#n.protocol="ws:")),this.#d());return}}}async messageReceivedCallback(e){switch(e.kind){case Ln:{for(this.#r??=this.attachShadow({mode:e.open_shadow_root?"open":"closed"});this.#r.firstChild;)this.#r.firstChild.remove();let t=(s,c,u,h)=>{let d=this.#x(s,h??[]);return{kind:Vn,path:c,name:u,event:d}},r=(s,c)=>{this.#e?.send(c)},i=Pn(this.#r);this.#s=new $e(this.#r,t,r,i),this.#o=new Set(e.observed_attributes);let l=this.#u.filter(([s])=>this.#o.has(s)).map(([s,c])=>({kind:Ne,name:s,value:c}));this.#u=[],this.#l=new Set(e.observed_properties);for(let s of this.#l)Object.defineProperty(this,s,{get(){return this[`_${s}`]},set(c){this[`_${s}`]=c,this.#e?.send({kind:Gn,name:s,value:c})}});for(let[s,c]of Object.entries(e.provided_contexts))this.provide(s,c);for(let s of[...new Set(e.requested_contexts)])this.dispatchEvent(new Oe(s,(c,u)=>{this.#e?.send({kind:Wn,key:s,value:c}),this.#f.add(u)}));l.length&&this.#e.send({kind:Ie,messages:l}),e.will_adopt_styles&&await this.#h(),this.#r.addEventListener("context-request",s=>{if(!s.context||!s.callback||!this.#a.has(s.context))return;s.stopImmediatePropagation();let c=this.#a.get(s.context);if(s.subscribe){let u=new WeakRef(s.callback),h=()=>{c.subscribers=c.subscribers.filter(d=>d!==u)};c.subscribers.push([u,h]),s.callback(c.value,h)}else s.callback(c.value)}),this.#s.mount(e.vdom),this.dispatchEvent(new CustomEvent("lustre:mount"));break}case Rn:{this.#s.push(e.patch);break}case Fn:{this.dispatchEvent(new CustomEvent(e.name,{detail:e.data}));break}case Hn:{this.provide(e.key,e.value);break}}}disconnectedCallback(){for(let e of this.#f)e();this.#f.clear(),this.#e&&(this.#e.close(),this.#e=null)}provide(e,t){if(!this.#a.has(e))this.#a.set(e,{value:t,subscribers:[]});else{let r=this.#a.get(e);r.value=t;for(let i=r.subscribers.length-1;i>=0;i--){let[o,l]=r.subscribers[i],s=o.deref();if(!s){r.subscribers.splice(i,1);continue}s(t,l)}}}#d(){if(!this.#n||!this.#t)return;this.#e&&this.#e.close();let i={onConnect:()=>{this.#c=!0,this.dispatchEvent(new CustomEvent("lustre:connect"),{detail:{route:this.#n,method:this.#t}})},onMessage:o=>{this.messageReceivedCallback(o)},onClose:()=>{this.#c=!1,this.dispatchEvent(new CustomEvent("lustre:close",{detail:{route:this.#n,method:this.#t}}))}};switch(this.#t){case"ws":this.#e=new st(this.#n,i);break;case"sse":this.#e=new ot(this.#n,i);break;case"polling":this.#e=new lt(this.#n,i);break}}async#h(){for(;this.#i.length;)this.#i.pop().remove(),this.#r.firstChild.remove();this.#i=await un(this.#r)}#x(e,t=[]){let r={};(e.type==="input"||e.type==="change")&&t.push("target.value"),e.type==="submit"&&t.push("detail.formData");for(let i of t){let o=i.split(".");for(let l=0,s=e,c=r;l<o.length;l++){if(l===o.length-1){c[o[l]]=s[o[l]];break}c=c[o[l]]??={},s=s[o[l]]}}return r}},st=class{#r;#t;#n=!1;#e=[];#i=!0;#s=500;#o=1e4;#l;#c;#u;constructor(e,{onConnect:t,onMessage:r,onClose:i}){this.#r=e,this.#l=t,this.#c=r,this.#u=i,this.#a()}#a(){this.#t=new WebSocket(this.#r),this.#i=!0,this.#e=[],this.#t.onopen=()=>{this.#s=500,this.#l()},this.#t.onmessage=({data:e})=>{try{this.#c(JSON.parse(e))}finally{this.#e.length?this.#t.send(JSON.stringify({kind:Ie,messages:this.#e})):this.#n=!1,this.#e=[]}},this.#t.onclose=e=>{this.#u(),e.code!==1e3&&this.#i&&this.#f()}}#f(){let e=()=>{this.#i&&(this.#a(),this.#s=Math.min(this.#s*2,this.#o))};if(document.hidden){let t=()=>{!document.hidden&&this.#i&&(document.removeEventListener("visibilitychange",t),e())};document.addEventListener("visibilitychange",t)}else setTimeout(e,this.#s)}send(e){if(!(!this.#t||this.#t.readyState!==WebSocket.OPEN))if(this.#n){this.#e.push(e);return}else this.#t.send(JSON.stringify(e)),this.#n=!0}close(){this.#i=!1,this.#t.close(1e3),this.#t=null}},ot=class{#r;#t;#n=!0;#e=500;#i=1e4;#s;#o;#l;constructor(e,{onConnect:t,onMessage:r,onClose:i}){this.#r=e,this.#s=t,this.#o=r,this.#l=i,this.#c()}#c(){this.#t=new EventSource(this.#r),this.#e=500,this.#n=!0,this.#t.onopen=()=>{this.#s()},this.#t.onmessage=({data:e})=>{try{this.#o(JSON.parse(e))}catch{}},this.#t.onerror=()=>{this.#t.close(),this.#l(),this.#n&&this.#u()}}#u(){let e=()=>{this.#n&&(this.#c(),this.#e=Math.min(this.#e*2,this.#i))};if(document.hidden){let t=()=>{!document.hidden&&this.#n&&(document.removeEventListener("visibilitychange",t),e())};document.addEventListener("visibilitychange",t)}else setTimeout(e,this.#e)}send(e){}close(){this.#n=!1,this.#t.close(),this.#l()}},lt=class{#r;#t;#n;#e;#i;#s;constructor(e,{onConnect:t,onMessage:r,onClose:i,...o}){this.#r=e,this.#e=t,this.#i=r,this.#s=i,this.#t=o.interval??5e3,this.#o().finally(()=>{this.#e(),this.#n=setInterval(()=>this.#o(),this.#t)})}async send(e){}close(){clearInterval(this.#n),this.#s()}#o(){return fetch(this.#r).then(e=>e.json()).then(this.#i).catch(console.error)}};customElements.define("lustre-server-component",it);export{it as ServerComponent};
